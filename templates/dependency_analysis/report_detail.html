{% extends 'base.html' %}

{% block title %}Scan Report #{{ report.id }} - SecurityPlatform{% endblock %}

{% block content %}
<div class="fade-in">
    <div style="margin-bottom: 2rem;">
        <a href="{% url 'dependency_report_list' %}" style="color: var(--text-muted); font-size: 0.875rem;">&larr; Back to History</a>
        <h1 style="margin-top: 0.5rem;">Scan Report #{{ report.id }}</h1>
        <p style="color: var(--text-muted);">Scanned on {{ report.scan_date|date:"F d, Y at H:i" }}</p>
    </div>

    <div class="grid-3" style="margin-bottom: 2rem;">
        <div class="card" style="text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">Total Dependencies</p>
            <p style="font-size: 2rem; font-weight: 700; margin: 0;">{{ report.total_dependencies }}</p>
        </div>
        <div class="card" style="text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">Vulnerabilities Found</p>
            <p style="font-size: 2rem; font-weight: 700; margin: 0; color: {% if report.vulnerabilities_found > 0 %}var(--danger-color){% else %}var(--success-color){% endif %};">
                {{ report.vulnerabilities_found }}
            </p>
        </div>
        <div class="card" style="text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">Status</p>
            <p style="font-size: 2rem; font-weight: 700; margin: 0;">
                {% if report.vulnerabilities_found > 0 %}Failure{% else %}Pass{% endif %}
            </p>
        </div>
    </div>

    <h2>Found Vulnerabilities</h2>
    {% if vulnerabilities %}
        <div style="display: grid; gap: 1rem;">
            {% for vuln in vulnerabilities %}
                <div class="card" style="border-left: 4px solid {% if vuln.severity == 'Critical' %}var(--danger-color){% elif vuln.severity == 'High' %}#f97316{% else %}var(--warning-color){% endif %};">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <h3 style="margin: 0; font-size: 1.25rem;">{{ vuln.library_name }} <span style="font-weight: 400; color: var(--text-muted);">{{ vuln.version }}</span></h3>
                        <span class="status-badge status-danger">{{ vuln.severity }}</span>
                    </div>
                    <p style="font-weight: 600; margin-bottom: 0.5rem;">{{ vuln.cve_id }}</p>
                    <p style="color: var(--text-muted); margin-bottom: 1rem;">{{ vuln.description }}</p>
                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                        <p style="margin: 0; font-size: 0.875rem; font-weight: 600;">Remediation:</p>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--success-color);">{{ vuln.remediation }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card" style="text-align: center; padding: 3rem;">
            <p style="font-size: 3rem; margin: 0 0 1rem 0;">âœ…</p>
            <h3>No Vulnerabilities Found</h3>
            <p style="color: var(--text-muted);">Your dependencies appear to be safe based on our database.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
